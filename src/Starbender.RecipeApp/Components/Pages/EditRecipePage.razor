@page "/recipes/edit/{RecipeId:int}"

@using Starbender.RecipeApp.Services.Contracts
@using Starbender.RecipeApp.Services.Contracts.Dtos
@using Starbender.RecipeApp.Blazor.Components

@inject IRecipeAppService RecipeService
@inject NavigationManager NavigationManager

<MudContainer MaxWidth="MaxWidth.Medium" Class="py-6">
    <MudText Typo="Typo.h4" Class="mb-4">Edit Recipe #@RecipeId</MudText>

    @if (_isLoading)
    {
        <MudProgressCircular Indeterminate="true" Color="Color.Primary" />
    }
    else if (_recipe is null)
    {
        <MudAlert Severity="Severity.Warning">
            Recipe with id @RecipeId was not found.
        </MudAlert>
    }
    else
    {
        <RecipeEditor Model="_recipe" OnValidSubmit="HandleSaveAsync" OnCancel="HandleCancel" />
    }
</MudContainer>

    @code {

    [Parameter]
    public int RecipeId { get; set; }

    private RecipeDto? _recipe;
    private bool _isLoading = true;

    protected override async Task OnParametersSetAsync()
    {
        _isLoading = true;

        _recipe = RecipeId != 0
            ? await RecipeService.GetAsync(RecipeId)
            : new();

        _isLoading = false;
    }

    private async Task HandleSaveAsync(RecipeDto recipe)
    {
        await RecipeService.UpdateAsync(recipe);
        NavigationManager.NavigateTo("/");
    }

    private void HandleCancel()
    {
        NavigationManager.NavigateTo("/");
    }
}
