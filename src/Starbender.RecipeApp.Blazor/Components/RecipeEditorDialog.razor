@inherits RecipeComponentBase

<RecipeEditor Model="Model" OnValidSubmit="HandleSavedAsync" OnCancel="HandleCancelAsync" />

@code {

    [Inject] private IRecipeAppService RecipeService { get; set; } = null!;

    [CascadingParameter]
    private IMudDialogInstance MudDialog { get; set; } = default!;

    [Parameter]
    public RecipeDto Model { get; set; } = new();

    [Parameter]
    public EventCallback<RecipeDto> OnSaved { get; set; }

    private async Task HandleSavedAsync(RecipeDto recipe)
    {
        try
        {
            Model = Model.Id == 0
                ? await RecipeService.CreateAsync(Model)
                : await RecipeService.UpdateAsync(Model);

            await OnSaved.InvokeAsync(Model);
            Snackbar.Add("Saved", Severity.Success);
            MudDialog.Close(DialogResult.Ok(Model));
        }
        catch (Exception ex)
        {
            Snackbar.Add(ex.Message, Severity.Error);
        }
    }

    private Task HandleCancelAsync()
    {
        MudDialog.Cancel();
        return Task.CompletedTask;
    }
}
