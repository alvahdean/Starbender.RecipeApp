@inherits RecipeComponentBase

@if (ShowText)
{
    <MudButton 
        Variant="Variant.Filled" 
        Color="Color.Success"
        OnClick="OnClick"
        EndIcon=@(Icon)
        IconSize="@Size.Small"
        Size="Size.Small"
        Disabled="@_isBusy"> 
            @(_isBusy ? "Creating..." : "Create")
        </MudButton>
}
else
{
    <MudIconButton 
        Variant="Variant.Filled"
        Color="Color.Success"
        OnClick="OnClick"
        Size="@Size.Small"
        Icon=@(Icon ?? Icons.Material.Outlined.Add)
        Disabled="@_isBusy" />
}

@code {
    [Inject] IDialogService DialogService { get; set; } = default!;
    [Parameter] public EventCallback<FullRecipeDto> HandleDialogSavedAsync { get; set; }
    [Parameter] public bool ShowText { get; set; } = false;
    [Parameter] public string Icon { get; set; } = Icons.Material.Outlined.Add;

    private bool _isBusy;

    private async Task OnClick()
    {
        if (_isBusy)
            return;

        try
        {
            _isBusy = true;
            var selectedRecipe = new FullRecipeDto();

            var parameters = new DialogParameters<RecipeEditorDialog>
        {
            { x => x.Model, selectedRecipe },
            { x => x.OnSaved, EventCallback.Factory.Create<FullRecipeDto>(this, HandleDialogSavedAsync) }
        };

            var options = new DialogOptions
            {
                MaxWidth = MaxWidth.Medium,
                FullWidth = true,
                CloseOnEscapeKey = true
            };

            var dialog = await DialogService.ShowAsync<RecipeEditorDialog>("Edit Recipe", parameters, options);
            await dialog.Result;
        }
        finally
        {
            _isBusy = false;
        }
    }
}
